!function(){const t=function(t,s){return window.webkit.messageHandlers.bluetooth.postMessage({action:t,data:s})};class s extends EventTarget{constructor(t,s,e){super(),this.device=t,this.uuid=s,this.isPrimary=e}}class e{constructor(e){this.connect=async()=>{const s=await t("connect",{uuid:this.device.uuid});return this.connected=s.connected,this},this.disconnect=async()=>{const s=await t("disconnect",{uuid:this.device.uuid});this.connected=!s.disconnected},this.getPrimaryServices=async e=>(await t("getPrimaryServices",{uuid:this.device.uuid,bluetoothServiceUUID:e})).services.map((t=>new s(this.device,t,!0))),this.device=e,this.connected=!1}}class i{constructor(t){this.id=t,this.isEmpty=()=>0===this.targets.length,this.addTarget=(t,s)=>{this.targets.push({name:t,target:s})},this.removeTarget=t=>{this.targets=this.targets.filter((s=>s.name!==t))},this.postMessage=t=>{const s=this.targets.find((s=>s.name===t.type));s&&s.target.dispatchEvent(t)},this.id=t,this.targets=[]}}const a=new class{constructor(){this.addTarget=(t,s,e)=>{let a=this.dispatchers.find((s=>s.id===t));a||(a=new i(t),this.dispatchers.push(a)),a.addTarget(s,e)},this.removeTarget=(t,s)=>{const e=this.dispatchers.find((s=>s.id===t));e&&e.removeTarget(s),e.isEmpty()&&(this.dispatchers=this.dispatchers.filter((s=>s.id!==t)))},this.removeAllTargets=t=>{this.dispatchers=this.dispatchers.filter((s=>s.id!==t))},this.postMessage=(t,s)=>{const e=this.dispatchers.find((s=>s.id===t));e&&e.postMessage(s)},this.dispatchers=[]}};class n extends EventTarget{constructor(t,s){super(),this.uuid=t,this.name=s,this.gatt=new e(this),a.addTarget(t,"gattserverdisconnected",this)}}class c extends EventTarget{constructor(){super(),this.onavailabilitychanged=t=>{},this.getAvailability=async()=>(await t("getAvailability")).isAvailable,this.getDevices=async()=>(await t("getDevices")).map((t=>new n(t.uuid,t.name))),this.requestDevice=async s=>{const e=await t("requestDevice",{options:s});return new n(e.uuid,e.name)},a.addTarget("bluetooth","availabilitychanged",this),this.addEventListener("availabilitychanged",(t=>{this.onavailabilitychanged(t)}))}}class h extends Event{constructor(t,s){super(t,s),this.value=null==s?void 0:s.value}}class r{constructor(){this.sendEvent=t=>{!function(t){const s=new h(t.name,{value:t.data});a.postMessage(t.id,s)}(t)},this.bluetooth=new c}}void 0===navigator.bluetooth&&(globalThis.topaz=new r,navigator.bluetooth=globalThis.topaz.bluetooth)}();
